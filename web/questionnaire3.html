<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>调查表新增</title>
    <script src="js/data-format.js"></script>
    <script src="js/jquery/2.0.0/jquery.min.js"></script>
    <script src="js/jquery/2.0.0/jquery.serializejson.js"></script>
    <link href="css/bootstrap/3.3.6/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">
    <link href="css/bootstrap/bootstrap-select.min.css" type="text/css" rel="stylesheet">
    <link href="css/dashboard.css" rel="stylesheet">
    <link href="css/dropdown-submenu.css" rel="stylesheet">
    <script type="text/javascript" src="js/bootstrap/bootstrap-datetimepicker.js" charset="UTF-8"></script>
    <script src="js/bootstrap/3.3.6/bootstrap.min.js"></script>
    <script src="js/bootstrap/bootstrap-datetimepicker.zh-CN.js"></script>
    <script src="js/bootstrap/bootstrap-select.min.js"></script>
    <script src="js/bootstrap/defaults-zh_CN.min.js"></script>
    <link href="css/bootstrap/navbar.css" rel="stylesheet">
    <script src="js/bootstrap/navbar.js"></script>
    <script src="js/time.js"></script>
    <script src="js/util.js"></script>
</head>
<script>

    function showLog() {
        $.ajax({
            type: "POST",                            // 方法类型
            url: "getLog",                           // url
            async : false,                           // 同步：意思是当有返回值以后才会进行后面的js程序
            dataType: "json",
            success: function (result) {
                console.log(result);
                if (result != undefined) {
                    var data = eval(result);
                    if (data.status == "success") {
                        setDataList(result);
                        $('#logModal').modal('show');
                    } else {
                        alert(data.message);
                    }
                }
            },
            error:function (result) {
            }
        });
    }
    function setDataList(result) {
        // 获取id为cloneTr的tr元素
        var id = 1;
        var tr = $("#clonedTr2");
        $.each(result.data, function (index, item) {
            // 克隆tr，每次遍历都可以产生新的tr
            var clonedTr = tr.clone();
            clonedTr.show();
            var _index = index;
            // 循环遍历cloneTr的每一个td元素，并赋值
            clonedTr.children("td").each(function (inner_index) {
                var obj = eval(item);
                // 根据索引为部分td赋值
                switch (inner_index) {
                    case (0):
                        $(this).html(id++);
                        break;
                    // 样品预约号
                    case (1):
                        $(this).html(obj.username);
                        break;
                    //样品状态
                    case (2):
                        $(this).html(obj.ip);
                        break;
                    // 公司名称
                    case (3):
                        $(this).html(getTimeStr(obj.time));
                        break;
                }
            });
            // 把克隆好的tr追加到原来的tr前面
            clonedTr.removeAttr("id");
            clonedTr.insertBefore(tr);
        });
        tr.hide();
    }
    $(window).on('load', function () {
        // 中文重写select 查询为空提示信息
        $('.selectpicker').selectpicker({
            language: 'zh_CN',
        //    style: 'btn-info',
            size: 4
        });
    });
    var id1;
    function loadSelectList() {
        loadNavigationList();   // 设置动态菜单
        // 设置下拉列表
        $.ajax({
            type: "POST",                            // 方法类型
            url: "getQuestionnaireSelectedList",                  // url
            dataType: "json",
            success: function (result) {
                if (result != undefined) {
                    var data = eval(result);
                    // 各下拉框数据填充
//                    console.log(data);
                    var formType = $("#formType");
                    formType.children().remove();
                    $.each(data.formTypeStrList, function (index, item) {
                        var option = $('<option />');
                        option.val(index);
                        option.text(item.name);
                        formType.append(option);
                    });
                    formType.get(0).selectedIndex = -1;


                    var smellType = $("#smellType");
                    smellType.children().remove();
                    $.each(data.smellTypeStrList, function (index, item) {
                        var option = $('<option />');
                        option.val(index);
                        option.text(item.name);
                        smellType.append(option);
                    });
                    smellType.get(0).selectedIndex = -1;

                    var solubility = $("#solubility");
                    solubility.children().remove();
                    $.each(data.solubilityStrList, function (index, item) {
                        var option = $('<option />');
                        option.val(index);
                        option.text(item.name);
                        solubility.append(option);
                    });
                    solubility.get(0).selectedIndex = -1;
                } else {
                    console.log(result);
                }
            },
            error:function (result) {
                console.log(result);
            }
        });
        setTimeout("loadPage3Info()", 50);
    }
    /**
     * 增加新行
     */
    function addNewLine() {
        // 获取id为cloneTr的tr元素
        var tr11 = $("#plusBtn").prev();
        var tr10 = tr11.prev();
        var tr9 = tr10.prev();
        var tr8 = tr9.prev();
        var tr7 = tr8.prev();
        var tr6 = tr7.prev();
        var tr5 = tr6.prev();
        var tr4 = tr5.prev();
        var tr3 = tr4.prev();
        var tr2 = tr3.prev();
        var tr1 = tr2.prev();
        // 克隆tr，每次遍历都可以产生新的tr
        var clonedTr1 = tr1.clone();
        var clonedTr2 = tr2.clone();
        var clonedTr3 = tr3.clone();
        var clonedTr4 = tr4.clone();
        var clonedTr5 = tr5.clone();
        var clonedTr6 = tr6.clone();
        var clonedTr7 = tr7.clone();
        var clonedTr8 = tr8.clone();
        var clonedTr9 = tr9.clone();
        var clonedTr10 = tr10.clone();
        var clonedTr11 = tr11.clone();
        clonedTr1.addClass("newLine");
        clonedTr2.addClass("newLine");
        clonedTr3.addClass("newLine");
        clonedTr4.addClass("newLine");
        clonedTr5.addClass("newLine");
        clonedTr6.addClass("newLine");
        clonedTr7.addClass("newLine");
        clonedTr8.addClass("newLine");
        clonedTr9.addClass("newLine");
        clonedTr10.addClass("newLine");
        clonedTr11.addClass("newLine");
        // 获取编号
        var id = tr1.children().get(0).innerHTML;
        var num = parseInt(id);
        if (!isNaN(num)) {
            num++;
            id1 = num;
        } else {
            id1++;
            num = id1;
        }
        clonedTr1.children().get(0).innerHTML = num;
        var delBtn = "<a class='btn btn-default btn-xs' onclick='delLine(this);id1--;'><span class='glyphicon glyphicon-minus' aria-hidden='true'></span></a>&nbsp;";
        clonedTr1.children("td:eq(0)").prepend(delBtn);

        changeName(clonedTr1,num);
        changeName(clonedTr2,num);
        changeName(clonedTr3,num);
        changeName(clonedTr4,num);
        changeName(clonedTr5,num);
        changeName(clonedTr6,num);
        changeName(clonedTr7,num);
        changeName(clonedTr8,num);
        changeName(clonedTr9,num);
        changeName(clonedTr10,num);
        changeName(clonedTr11,num);

        clonedTr1.insertAfter(tr11);
        clonedTr2.insertAfter(clonedTr1);
        clonedTr3.insertAfter(clonedTr2);
        clonedTr4.insertAfter(clonedTr3);
        clonedTr5.insertAfter(clonedTr4);
        clonedTr6.insertAfter(clonedTr5);
        clonedTr7.insertAfter(clonedTr6);
        clonedTr8.insertAfter(clonedTr7);
        clonedTr9.insertAfter(clonedTr8);
        clonedTr10.insertAfter(clonedTr9);
        clonedTr11.insertAfter(clonedTr10);
        tr1.removeAttr("id");
        tr2.removeAttr("id");
        tr3.removeAttr("id");
        tr4.removeAttr("id");
        tr5.removeAttr("id");
        tr6.removeAttr("id");
        tr7.removeAttr("id");
        tr8.removeAttr("id");
        tr9.removeAttr("id");
        tr10.removeAttr("id");
        tr11.removeAttr("id");
        $('.selectpicker').data('selectpicker', null);
        $('.bootstrap-select').find("button:first").remove();
        $('.selectpicker').selectpicker();
    }

    /**
     * 更新name
     * @param element
     * @param num
     */
    function changeName(element,num) {
        element.find("input[name*='deriveWastesList'],select[name*='deriveWastesList']").each(function () {
            var oldName = $(this).attr("name");
            var newName = oldName.replace(/[0-9]\d*/, num - 1);
            $(this).attr('name', newName);
            if ($(this).attr('type') == "text") $(this).val("");
            else if ($(this).attr('type') == "radio" || $(this).attr('type') == "checkbox") $(this).removeAttr('checked');
            else if ($(this)[0].tagName == "SELECT") $(this).get(0).selectedIndex = -1;
        });
    }

    /**
     * 更新name
     * @param element
     * @param num
     */
    function changeName1(element,num) {
        element.find("input[name*='deriveWastesList'],select[name*='deriveWastesList']").each(function () {
            var oldName = $(this).attr("name");
            var newName = oldName.replace(/[0-9]\d*/, num - 1);
            $(this).attr('name', newName);
        });
    }
    function delLine(e) {
        var tr1 = e.parentElement.parentElement;
        var length = $(tr1.parentNode).children().length - 2;         // 行数
        var tBody = $(tr1.parentNode);
        var tr2 = tr1.nextElementSibling;
        var tr3 = tr2.nextElementSibling;
        var tr4 = tr3.nextElementSibling;
        var tr5 = tr4.nextElementSibling;
        var tr6 = tr5.nextElementSibling;
        var tr7 = tr6.nextElementSibling;
        var tr8 = tr7.nextElementSibling;
        var tr9 = tr8.nextElementSibling;
        var tr10 = tr9.nextElementSibling;
        var tr11 = tr10.nextElementSibling;
        tr1.parentNode.removeChild(tr1);
        tr2.parentNode.removeChild(tr2);
        tr3.parentNode.removeChild(tr3);
        tr4.parentNode.removeChild(tr4);
        tr5.parentNode.removeChild(tr5);
        tr6.parentNode.removeChild(tr6);
        tr7.parentNode.removeChild(tr7);
        tr8.parentNode.removeChild(tr8);
        tr9.parentNode.removeChild(tr9);
        tr10.parentNode.removeChild(tr10);
        tr11.parentNode.removeChild(tr11);
        var j = 1;
        for(var i = 1; i< length / 11 - 1; i++){             // 更新序号
            j++;
            tBody.children().eq(i*11 + 1).children().eq(0).get(0).innerHTML = j ;     // 更新序号
            changeName1(tBody.children().eq(i*11 + 1),j);
            changeName1(tBody.children().eq(i*11 + 2),j);
            changeName1(tBody.children().eq(i*11 + 3),j);
            changeName1(tBody.children().eq(i*11 + 4),j);
            changeName1(tBody.children().eq(i*11 + 5),j);
            changeName1(tBody.children().eq(i*11 + 6),j);
            changeName1(tBody.children().eq(i*11 + 7),j);
            changeName1(tBody.children().eq(i*11 + 8),j);
            changeName1(tBody.children().eq(i*11 + 9),j);
            changeName1(tBody.children().eq(i*11 + 10),j);
            changeName1(tBody.children().eq(i*11 + 11),j);
            // 重新加上减行按钮
            var delBtn = "<a class='btn btn-default btn-xs' onclick='delLine(this);id1--;'><span class='glyphicon glyphicon-minus' aria-hidden='true'></span></a>&nbsp;";
            tBody.children().eq(i*11 + 1).children("td:eq(0)").prepend(delBtn);
        }
    }
</script>
<style>
    td {
        text-align:center;
        vertical-align: middle;
    }
    table{
        margin: auto;
    }
    table th, table td {
        vertical-align: middle!important;
    }
</style>
<body onload="loadSelectList();">
    <!--导航条-->
    <nav class="navbar navbar-inverse navbar-fixed-top float" id="navbar1" style="height: 50px;">
        <div class="main-title">
            <ul class="nav navbar-nav navbar-left navbar-side">
                <li>
                    <a href="#" onclick="$('body').toggleClass('sidebar-collapse');" style="width: 50px">
                        <span class="glyphicon glyphicon-menu-hamburger"></span>
                    </a>
                </li>
            </ul>
        </div>
        <div class="container navbar-left" style="width: 1000px;">
            <div class="navbar-header">
                <a class="navbar-brand" href="#"><img src="image/logo2.png"></a>
            </div>
            <div id="navbar" class="collapse navbar-collapse" style="margin-left: 150px;">
                <ul class="nav navbar-nav">
                    <li><a href="businessModel.html">首页</a></li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">产废单位管理<span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="clientBackup.html" id="function_48" onclick="checkAuthority($(this))">产废单位备案</a></li>
                            <li role="separator" class="divider"></li>
                            <li class="dropdown-submenu">
                                <a href="#">业务员分配管理</a>
                                <ul class="dropdown-menu">
                                    <li><a href="salesManage.html" id="function_80" onclick="checkAuthority($(this))">业务员管理</a></li>
                                    <li role="separator" class="divider"></li>
                                    <li><a href="clientSalesManage.html" id="function_81" onclick="checkAuthority($(this))">产废单位分配管理</a></li>
                                </ul>
                            </li>
                            <li role="separator" class="divider"></li>
                            <li><a href="questionnaireManage.html" id="function_50" onclick="checkAuthority($(this))">危废数据调查表管理</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="sampleInfo.html" id="function_51" onclick="checkAuthority($(this))">产废单位样品登记</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="wayBill1.html" id="function_52" onclick="checkAuthority($(this))">接运单管理</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">供应商管理<span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="supplierBackup.html" id="function_15" onclick="checkAuthority($(this))">供应商备案</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">合同管理<span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="contractManage.html" id="function_54" onclick="checkAuthority($(this))">合同列表</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="contractTemplate.html" id="function_55" onclick="checkAuthority($(this))">合同模板</a></li>
                        </ul>
                    </li>
                    <li><a href="archivesManage.html" id="function_18" onclick="checkAuthority($(this));">一企一档</a></li>
                    <li><a href="stockManage.html" id="function_19" onclick="checkAuthority($(this));">库存申报</a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div>
        <ul class="nav navbar-nav navbar-right">
            <li><a href="todo.html" title="事项">
                <span class="glyphicon glyphicon-bell"></span>
            </a>
            </li>
            <li><a href="#" title="邮件" onclick="goToEmail()"><span class="glyphicon glyphicon-envelope"></span></a></li>
            <li class="dropdown">
                <a href="#" title="我的" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-user"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="personalInformation.html">个人信息</a></li>
                    <li><a href="admin.html">注销</a></li>
                </ul>
            </li>
        </ul>

    </nav>

    <div class="container-fluid">
        <div class="row">
            <div class="sidebar">
                <!--<h4>博客管理系统(四月)</h4>-->
                <!--<div class="cover">-->
                <!--<h4><img class="img-circle" src="image/icons.png"/></h4>-->
                <!--<b>Hi~ 小主</b>-->
                <!--<p>超级管理员</p>-->
                <!--</div>-->
                <ul class="sidenav animated fadeInUp">
                    <!--<li><a href="#"><span class="glyphicon glyphicon-backward" aria-hidden="true"></span></a></li>-->
                    <li><a class="withripple" href="wastesPlatform.html"id="function_1" onclick="checkAuthority($(this))"><span class="glyphicon glyphicon-list" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;系统概览 </span><span class="iright pull-right">&gt;</span><span class="sr-only">(current)</span></a></li>
                    <li class="active"><a class="withripple" href="businessModel.html"id="function_2" onclick="checkAuthority($(this))"><span class="glyphicon glyphicon-user" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;商务管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="compatibilityPlan.html"id="function_3" onclick="checkAuthority($(this))"><span class="glyphicon glyphicon-list" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;配伍计划 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="receiveManagement.html"id="function_4" onclick="checkAuthority($(this))"><span class="glyphicon glyphicon-log-in" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;接收管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="storageManagement.html"id="function_5" onclick="checkAuthority($(this))"><span class="glyphicon glyphicon-save" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;贮存管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="preprocessingManagement.html"id="function_6" onclick="checkAuthority($(this))"><span class="glyphicon glyphicon-sort-by-attributes-alt" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;预备管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="dispositionManagement.html"id="function_7" onclick="checkAuthority($(this))"><span class="glyphicon glyphicon-retweet" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;处置管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="secondaryManagement.html"id="function_8" onclick="checkAuthority($(this))"><span class="glyphicon glyphicon-tags" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;次生管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="procurementManagement.html"id="function_9" onclick="checkAuthority($(this))"><span class="glyphicon glyphicon-indent-right" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;采购管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="reportManagement.html"id="function_10" onclick="checkAuthority($(this))"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;报表管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="basicData.html" id="function_11" onclick="checkAuthority($(this))"><span class="glyphicon glyphicon-signal" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;基础数据 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="infrastructure.html" id="function_12" onclick="checkAuthority($(this))"><span class="glyphicon glyphicon-cog" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;系统设置 </span><span class="iright pull-right">&gt;</span></a></li>
                </ul>
            </div>
        </div>

        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <div class="row">
                <ol class="breadcrumb">
                    <li><a href="businessModel.html">商务管理</a></li>
                    <li><a href="#">产废单位管理</a></li>
                    <li><a href="questionnaireManage.html">危险数据调查表管理</a></li>
                    <li class="active">调查表新增</li>
                </ol>
                <p class="text-right"><b>调查单号&nbsp;&nbsp;</b><span id="questionnaireId"></span></p>
            </div>
            <h4 class="sub-header">调查表新增</h4>
            <form method="post" id="page3Info" enctype="multipart/form-data">
                <div class="row">
                    <p class="text-left" style="color: #e5454d;font-size: 17px;">危废产生中使用的主要原、辅料和有可能带入的化学物质&nbsp;&nbsp;</p>
                </div>
                <div class="row">
                    <div class="form-horizontal col-md-12">
                        <div class="form-group">
                            <table class="table table-bordered">
                                <tr>
                                    <th class="text-center" style="width: 70px;">序号</th>
                                    <th class="text-center">危废名称</th>
                                    <th class="text-center">危废代码</th>
                                    <th class="text-center" colspan="2">物理形态</th>
                                    <th class="text-center" colspan="6">均质与混合多项物</th>
                                    <th class="text-center" colspan="3">敏感酸性组份</th>
                                </tr>
                                <tr>
                                    <td class="text-center" rowspan="11">1</td>
                                    <td class="text-center" rowspan="11" onclick="focusInput(this);"><input maxlength="8" type="text" class="focus" style="width:100px" name="deriveWastesList[0].name"></td>
                                    <td class="text-center" rowspan="11">
                                        <div class="btn-group">
                                            <select class="selectpicker input-xlarge form-control" data-live-search="true" data-live-search-placeholder="搜索..." id="code" name="deriveWastesList[0].code"></select>
                                        </div>
                                    </td>
                                    <td class="text-center" rowspan="2">物质形态</td>
                                    <td class="text-center">
                                        <div class="btn-group">
                                            <select class="form-control" id="formType" name="deriveWastesList[0].formType"></select>
                                        </div>
                                    </td>
                                    <td class="text-center" colspan="6">
                                        <input maxlength="8" type="radio" name="deriveWastesList[0].isMixture" value="false">均质&nbsp;
                                        <input maxlength="8" type="radio" name="deriveWastesList[0].isMixture" value="true">混合多项物
                                    </td>
                                    <td class="text-center">组份</td>
                                    <td class="text-center">有机</td>
                                    <td class="text-center">无机</td>
                                </tr>
                                <tr>
                                    <td class="text-center"><input maxlength="8" type="text" placeholder="说明" class="focus" style="width:100px" name="deriveWastesList[0].formTypeDetail"></td>
                                    <td class="text-center" rowspan="2" colspan="3">混合多项物混合成分</td>
                                    <td class="text-center" colspan="3">预估含量(%)</td>
                                    <td class="text-center">
                                        <input maxlength="8" type="checkbox" name="deriveWastesList[0].sensitiveElementList[0].chemicalType" value="Chlorine">氯
                                    </td>
                                    <td class="text-center">
                                        <input maxlength="8" type="radio" name="deriveWastesList[0].sensitiveElementList[0].isOrganic" value="true">
                                    </td>
                                    <td class="text-center">
                                        <input maxlength="8" type="radio" name="deriveWastesList[0].sensitiveElementList[0].isOrganic" value="false">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center" rowspan="2">物质气味</td>
                                    <td class="text-center">
                                        <div class="btn-group">
                                            <select class="form-control" id="smellType" name="deriveWastesList[0].smellType"></select>
                                        </div>
                                    </td>
                                    <td class="text-center">最低</td>
                                    <td class="text-center">平均</td>
                                    <td class="text-center">最高</td>
                                    <td class="text-center">
                                        <input maxlength="8" type="checkbox" name="deriveWastesList[0].sensitiveElementList[1].chemicalType" value="Fluorine">氟
                                    </td>
                                    <td class="text-center">
                                        <input maxlength="8" type="radio" name="deriveWastesList[0].sensitiveElementList[1].isOrganic" value="true">
                                    </td>
                                    <td class="text-center">
                                        <input maxlength="8" type="radio" name="deriveWastesList[0].sensitiveElementList[1].isOrganic" value="false">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center"><input maxlength="8" type="text" placeholder="说明" class="focus" style="width:100px" name="deriveWastesList[0].smellTypeDetail"></td>
                                    <td class="text-center" colspan="3"><input maxlength="8" type="text" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[0].name"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[0].minimum"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[0].average"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[0].maximum"></td>
                                    <td class="text-center">
                                        <input maxlength="8" type="checkbox" name="deriveWastesList[0].sensitiveElementList[2].chemicalType" value="Bromine">溴
                                    </td>
                                    <td class="text-center">
                                        <input maxlength="8" type="radio" name="deriveWastesList[0].sensitiveElementList[2].isOrganic" value="true">
                                    </td>
                                    <td class="text-center">
                                        <input maxlength="8" type="radio" name="deriveWastesList[0].sensitiveElementList[2].isOrganic" value="false">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center" rowspan="2">可溶性</td>
                                    <td class="text-center">
                                        <div class="btn-group">
                                            <select class="form-control" id="solubility" name="deriveWastesList[0].solubility"></select>
                                        </div>
                                    </td>
                                    <td class="text-center" colspan="3"><input maxlength="8" type="text" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[1].name"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[1].minimum"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[1].average"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[1].maximum"></td>
                                    <td class="text-center">
                                        <input maxlength="8" type="checkbox" name="deriveWastesList[0].sensitiveElementList[3].chemicalType" value="Iodine">碘
                                    </td>
                                    <td class="text-center">
                                        <input maxlength="8" type="radio" name="deriveWastesList[0].sensitiveElementList[3].isOrganic" value="true">
                                    </td>
                                    <td class="text-center">
                                        <input maxlength="8" type="radio" name="deriveWastesList[0].sensitiveElementList[3].isOrganic" value="false">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center"><input maxlength="8" type="text" placeholder="说明" class="focus" style="width:100px" name="deriveWastesList[0].solubilityDetail"></td>
                                    <td class="text-center" colspan="3"><input maxlength="8" type="text" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[2].name"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[2].minimum"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[2].average"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[2].maximum"></td>
                                    <td class="text-center">
                                        <input maxlength="8" type="checkbox" name="deriveWastesList[0].sensitiveElementList[4].chemicalType" value="Sulphur">硫
                                    </td>
                                    <td class="text-center">
                                        <input maxlength="8" type="radio" name="deriveWastesList[0].sensitiveElementList[4].isOrganic" value="true">
                                    </td>
                                    <td class="text-center">
                                        <input maxlength="8" type="radio" name="deriveWastesList[0].sensitiveElementList[4].isOrganic" value="false">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center" rowspan="2">储存温度</td>
                                    <td class="text-center">
                                        <input maxlength="8" type="radio" name="deriveWastesList[0].isLowTemp" value="false">常温
                                    </td>
                                    <td class="text-center" colspan="3"><input maxlength="8" type="text" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[3].name"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[3].minimum"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[3].average"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[3].maximum"></td>
                                    <td class="text-center">
                                        <input maxlength="8" type="checkbox" name="deriveWastesList[0].sensitiveElementList[5].chemicalType" value="Phosphorus">磷
                                    </td>
                                    <td class="text-center">
                                        <input maxlength="8" type="radio" name="deriveWastesList[0].sensitiveElementList[5].isOrganic" value="true">
                                    </td>
                                    <td class="text-center">
                                        <input maxlength="8" type="radio" name="deriveWastesList[0].sensitiveElementList[5].isOrganic" value="false">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <input maxlength="8" type="radio" name="deriveWastesList[0].isLowTemp" value="true">低温<input maxlength="8" type="text" style="width:50px" name="deriveWastesList[0].lowTemp">℃
                                    </td>
                                    <td class="text-center" colspan="3"><input maxlength="8" type="text" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[4].name"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[4].minimum"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[4].average"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[4].maximum"></td>
                                    <td class="text-center">
                                        <input maxlength="8" type="checkbox" name="deriveWastesList[0].sensitiveElementList[6].chemicalType" value="Nitrogen">氮
                                    </td>
                                    <td class="text-center">
                                        <input maxlength="8" type="radio" name="deriveWastesList[0].sensitiveElementList[6].isOrganic" value="true">
                                    </td>
                                    <td class="text-center">
                                        <input maxlength="8" type="radio" name="deriveWastesList[0].sensitiveElementList[6].isOrganic" value="false">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center" rowspan="3">其他</td>
                                    <td class="text-center" rowspan="3">如为精馏残渣其可溶温度:<input maxlength="8" type="text" style="width:50px" name="deriveWastesList[0].solubleTemp">℃</td>
                                    <td class="text-center" colspan="3"><input maxlength="8" type="text" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[5].name"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[5].minimum"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[5].average"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[5].maximum"></td>
                                    <td class="text-center" colspan="3" rowspan="3">
                                        <p class="text-danger">备注:主要成分避免使用废溶剂、废油等笼统描述，尽可能详尽估算出含量</p>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center" colspan="3"><input maxlength="8" type="text" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[6].name"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[6].minimum"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[6].average"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[6].maximum"></td>
                                </tr>
                                <tr>
                                    <td class="text-center" colspan="3"><input maxlength="8" type="text" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[7].name"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[7].minimum"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[7].average"></td>
                                    <td class="text-center"><input maxlength="8" type="number" class="focus" style="width:100px" name="deriveWastesList[0].mixingElementList[7].maximum"></td>
                                </tr>
                                <tr id="plusBtn">
                                    <td><a class="btn btn-default btn-xs" onclick="addNewLine();"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></a></td>
                                    <td colspan="13"></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="row text-center">
                    <a class="btn btn-primary" onclick="savePage3Info(this)">上一页</a>
                    <a class="btn btn-primary" onclick="savePage3Info(this)">下一页</a>
                    <a class="btn btn-danger" href="questionnaireManage.html">返回</a>
                </div>
            </form>
        </div>
    </div>

    <div id="embed"></div>
</body>
<script type="text/javascript">
    $('#embed').load('embed/loginLogModal.html');
    // 获取问卷编号
    var url=location.search;
    var Request = {};
    if(url.indexOf("?")!=-1) {
        var str = url.substr(1)　//去掉?号
        strs = str.split("&");
        for(var i=0;i<strs.length;i++) {
            Request[strs[i ].split("=")[0]]=unescape(strs[ i].split("=")[1]);
        }
    }
    /**
     * 聚焦输入框
     * @param e
     */
    function focusInput(e) {
        // console.log("you click the td!");
        e.firstChild.focus();
    }
    /**
     * 装载页面3的数据
     */
    function loadPage3Info() {
        $(".newLine").remove();            // 删除旧行
        // 添加危废信息
        $.ajax({
            type: "POST",                       // 方法类型
            url: "getWastesInfoList",              // url
            cache: false,
            async: false,                      // 同步：意思是当有返回值以后才会进行后面的js程序
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (result) {
                if (result != undefined) {
                    var data = eval(result.data);
                    // 各下拉框数据填充
                    var wastesInfoList = $("#code");
                    // 清空遗留元素
                    wastesInfoList.children().remove();
                    $.each(data, function (index, item) {
                        var option = $('<option />');
                        option.val(item.code);
                        option.text(item.code);
                        wastesInfoList.append(option);
                    });
                    wastesInfoList.removeAttr('id');
                    $('.selectpicker').selectpicker('refresh');
                } else {
                    console.log(result);
                }
            },
            error: function (result) {
                console.log(result);
            }
        });
        $.ajax({
            type: "POST",
            url: "getCurrentQuestionnaire",
            async: false,
            dataType: "json",
            success: function (result) {
                if (result != undefined) {
                    if (result.status == "success") {
                        var data = eval(result);
                        $("#questionnaireId").text(data.data.questionnaireId);
                        // for(var i = 0; i < data.data.wasteProcessList.length; i++){
                        //     if (i > 0) addNewLine();
                        //     var $i = i;
                        //     $("select[name='deriveWastesList[" + $i + "].code']").selectpicker('val', data.data.wasteProcessList[i].code);
                        // }
                        for (var i = 0; i < data.data.deriveWastesList.length; i++) {
                           if (i > 0) addNewLine();
                            var $i = i;
                            $("input[name='deriveWastesList[" + $i + "].name']").val(data.data.deriveWastesList[i].name);
                            $("select[name='deriveWastesList[" + $i + "].code']").selectpicker('val', data.data.deriveWastesList[i].code);
                            if (data.data.deriveWastesList[i].formType != null) $("select[name='deriveWastesList[" + $i + "].formType']").get(0).selectedIndex = data.data.deriveWastesList[i].formType.index-1;
                            $("input[name='deriveWastesList[" + $i + "].formTypeDetail']").val(data.data.deriveWastesList[i].formTypeDetail);
                            if (data.data.deriveWastesList[i].smellType != null) $("select[name='deriveWastesList[" + $i + "].smellType']").get(0).selectedIndex = data.data.deriveWastesList[i].smellType.index-1;
                            $("input[name='deriveWastesList[" + $i + "].smellTypeDetail']").val(data.data.deriveWastesList[i].smellTypeDetail);
                            if (data.data.deriveWastesList[i].solubility != null) $("select[name='deriveWastesList[" + $i + "].solubility']").get(0).selectedIndex = data.data.deriveWastesList[i].solubility.index-1;
                            $("input[name='deriveWastesList[" + $i + "].solubilityDetail']").val(data.data.deriveWastesList[i].solubilityDetail);
                            $("input[name='deriveWastesList[" + $i + "].lowTemp']").val(data.data.deriveWastesList[i].lowTemp);
                            $("input[name='deriveWastesList[" + $i + "].solubleTemp']").val(data.data.deriveWastesList[i].solubleTemp);
                            if (data.data.deriveWastesList[i].isLowTemp) $("input[name='deriveWastesList[" + $i + "].isLowTemp'][value='true']").attr("checked",true);
                            else $("input[name='deriveWastesList[" + $i + "].isLowTemp'][value='false']").attr("checked",true);
                            if (data.data.deriveWastesList[i].isMixture) $("input[name='deriveWastesList[" + $i + "].isMixture'][value='true']").attr("checked",true);
                            else $("input[name='deriveWastesList[" + $i + "].isMixture'][value='false']").attr("checked",true);
                            for (var j = 0; j < data.data.deriveWastesList[i].mixingElementList.length; j++) {
                                var $j = j;
                                $("input[name='deriveWastesList[" + $i + "].mixingElementList[" + $j + "].name']").val(data.data.deriveWastesList[i].mixingElementList[j].name);
                                $("input[name='deriveWastesList[" + $i + "].mixingElementList[" + $j + "].minimum']").val(data.data.deriveWastesList[i].mixingElementList[j].minimum);
                                $("input[name='deriveWastesList[" + $i + "].mixingElementList[" + $j + "].average']").val(data.data.deriveWastesList[i].mixingElementList[j].average);
                                $("input[name='deriveWastesList[" + $i + "].mixingElementList[" + $j + "].maximum']").val(data.data.deriveWastesList[i].mixingElementList[j].maximum);
                            }
                            for (var j = 0; j < data.data.deriveWastesList[i].sensitiveElementList.length; j++) {
                                var $j = data.data.deriveWastesList[i].sensitiveElementList[j].chemicalType.index - 1;
                                $("input[name='deriveWastesList[" + $i + "].sensitiveElementList[" + $j + "].chemicalType']").attr("checked",true);
                                if (data.data.deriveWastesList[i].sensitiveElementList[j].isOrganic) $("input[name='deriveWastesList[" + $i + "].sensitiveElementList[" + $j + "].isOrganic'][value='true']").attr("checked",true);
                                else $("input[name='deriveWastesList[" + $i + "].sensitiveElementList[" + $j + "].isOrganic'][value='false']").attr("checked",true);
                            }
                        }
                    }
                }
            },
            error: function (result) {

            }
        });
    }
    function savePage3Info(e) {
        // 获取按钮的名字
        var btnName = e.innerHTML;
        // 制作json数据
        var data = {};
        data['questionnaireId'] = $("input[name='questionnaireId']").text();
        // 获取引入化学物质的数量
        var deriveWastesCount = $("select[name$='code']").length;
        // 可能引入化学物质列表
        data['deriveWastesList'] = [];
        data['wasteProcessList'] = [];
        for (var i = 0; i < deriveWastesCount; i++) {
            var $i = i;
            console.log($("select[name='deriveWastesList[" + $i + "].code']"));
            var deriveWastes = {};
            var wasteProcess = {};
            deriveWastes.name = $("input[name='deriveWastesList[" + $i + "].name']").val();
            deriveWastes.code = $("select[name='deriveWastesList[" + $i + "].code']").selectpicker('val');
            wasteProcess.code = deriveWastes.code;
            deriveWastes.formType = $("select[name='deriveWastesList[" + $i + "].formType']").val();
            deriveWastes.formTypeDetail = $("input[name='deriveWastesList[" + $i + "].formTypeDetail']").val();
            deriveWastes.smellType = $("select[name='deriveWastesList[" + $i + "].smellType']").val();
            deriveWastes.smellTypeDetail = $("input[name='deriveWastesList[" + $i + "].smellTypeDetail']").val();
            deriveWastes.solubility = $("select[name='deriveWastesList[" + $i + "].solubility']").val();
            deriveWastes.solubilityDetail = $("input[name='deriveWastesList[" + $i + "].solubilityDetail']").val();
            deriveWastes.isLowTemp = $("input[name='deriveWastesList[" + $i + "].isLowTemp']:checked").val();
            deriveWastes.lowTemp = $("input[name='deriveWastesList[" + $i + "].lowTemp']").val();
            deriveWastes.solubleTemp = $("input[name='deriveWastesList[" + $i + "].solubleTemp']").val();
            deriveWastes.isMixture = $("input[name='deriveWastesList[" + $i + "].isMixture']:checked").val();
            deriveWastes['mixingElementList'] = [];
            deriveWastes['sensitiveElementList'] = [];
            // 混合物成分列表
            var mixingElementList = $("input[name^='deriveWastesList[" + $i + "]'][name$='name'][name*='mixingElementList']");
            var mixingElementArray = [];
            mixingElementList.each(function(){
                if ($(this).val() != '') {
                    var name = $(this).attr("name");
                    var j = name.split('[')[2].split(']')[0];
                    mixingElementArray.push(j);
                }
            });
            for (var j = 0; j < mixingElementArray.length; j++)
            {
                var $j = mixingElementArray[j];
                var mixingElement = {};
                mixingElement.name = $("input[name='deriveWastesList[" + $i + "].mixingElementList["+ $j +"].name']").val();
                mixingElement.minimum = $("input[name='deriveWastesList[" + $i + "].mixingElementList["+ $j +"].minimum']").val();
                mixingElement.average = $("input[name='deriveWastesList[" + $i + "].mixingElementList["+ $j +"].average']").val();
                mixingElement.maximum = $("input[name='deriveWastesList[" + $i + "].mixingElementList["+ $j +"].maximum']").val();
                deriveWastes.mixingElementList.push(mixingElement);
            }

            var sensitiveElementList = $("input[name^='deriveWastesList[" + $i + "]'][name$='chemicalType']:checked");
            var sensitiveElementArray = [];
            sensitiveElementList.each(function(){
                if ($(this).val() != '') {
                    var name = $(this).attr("name");
                    var j = name.split('[')[2].split(']')[0];
                    sensitiveElementArray.push(j);
                }
            });
            for (var j = 0; j < sensitiveElementArray.length; j++) {
                // 敏感成分列表
                var $j = sensitiveElementArray[j];
                var sensitiveElement = {};
                sensitiveElement.chemicalType = $("input[name='deriveWastesList[" + $i + "].sensitiveElementList["+ $j +"].chemicalType']").val();
                sensitiveElement.isOrganic = $("input[name='deriveWastesList[" + $i + "].sensitiveElementList["+ $j +"].isOrganic']:checked").val();
                deriveWastes.sensitiveElementList.push(sensitiveElement);
            }
            data['deriveWastesList'].push(deriveWastes);
            data['wasteProcessList'].push(wasteProcess);
        }
        console.log(data);
        $.ajax({
            type: "POST",                            // 方法类型
            url: "savePage3Info",               // url
            async : false,                           // 同步：意思是当有返回值以后才会进行后面的js程序
            dataType: "json",
            data: JSON.stringify(data),
            contentType: 'application/json;charset=utf-8',
            traditional: true,
            success: function (result) {
                if (result != undefined) {
                    console.log(result);
                    if (result.status == "success") {
                        if (Request["type"] != null && Request["type"] != '') {
                            if (btnName == "下一页") $(location).attr('href', 'questionnaire4.html?questionnaireId=' + Request["questionnaireId"] + '&type=' + Request["type"]);
                            else if (btnName == "上一页") $(location).attr('href', 'questionnaire2.html?questionnaireId=' + Request["questionnaireId"] + '&type=' + Request["type"]);
                        } else if(Request["questionnaireId"] != null && Request["questionnaireId"] != '') {
                            if (btnName == "下一页") $(location).attr('href', 'questionnaire4.html?questionnaireId=' + Request["questionnaireId"]);
                            else if (btnName == "上一页") $(location).attr('href', 'questionnaire2.html?questionnaireId=' + Request["questionnaireId"]);
                        } else {
                            if (btnName == "下一页") $(location).attr('href', 'questionnaire4.html');
                            else if (btnName == "上一页") $(location).attr('href', 'questionnaire2.html');
                        }
                    }
                }
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                console.log("错误信息:" + XMLHttpRequest.responseText);
            }
        });
    }
</script>
</html>