<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>产废服务平台</title>
    <script src="js/jquery/2.0.0/jquery.min.js"></script>
    <script src="js/jquery/2.0.0/jquery.serializejson.js"></script>
    <link href="css/bootstrap/3.3.6/bootstrap.min.css" rel="stylesheet">
    <script src="js/bootstrap/3.3.6/bootstrap.min.js"></script>
    <link href="css/dashboard.css" rel="stylesheet">
    <link href="css/bootstrap/navbar.css" rel="stylesheet">
    <script src="js/bootstrap/navbar.js"></script>
    <script src="js/time.js"></script>
    <script src="js/util.js"></script>
    <script src="js/business/map.js"></script>
    <script type="text/javascript" src="js/bootstrap/bootstrap-datetimepicker.js" charset="UTF-8"></script>
    <script type="text/javascript" src="js/jquery/jquery-ui.min.js" charset="UTF-8"></script>
    <link href="css/bootstrap/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">
    <!--引用百度地图API-->
    <style type="text/css">
        html,body{margin:0;padding:0;}
        .iw_poi_title {color:#CC5522;font-size:14px;font-weight:bold;overflow:hidden;padding-right:13px;white-space:nowrap}
        .iw_poi_content {font:12px arial,sans-serif;overflow:visible;padding-top:4px;white-space:-moz-pre-wrap;word-wrap:break-word}
    </style>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=3.0&ak=OcqSk1RGOIhd1nHCQdfFUAAGLrTcNH0j"></script>
</head>
<body>
    <!--导航条-->
    <nav class="navbar navbar-inverse navbar-fixed-top float" id="navbar1">
        <div class="main-title">
            <ul class="nav navbar-nav navbar-left navbar-side">
                <li>
                    <a href="#" onclick="$('body').toggleClass('sidebar-collapse');" style="width: 50px">
                        <span class="glyphicon glyphicon-menu-hamburger"></span>
                    </a>
                </li>
            </ul>
        </div>
        <div class="container navbar-left">
            <div class="navbar-header">
                <a class="navbar-brand" href="#"><img src="image/logo2.png"></a>
            </div>
            <div id="navbar" class="collapse navbar-collapse" style="margin-left: 150px;">
                <ul class="nav navbar-nav">
                    <li><a href="wastesPlatform.html">首页</a></li>
                    <li class="active"><a href="map.html" id="function_13" onclick="checkAuthority($(this))">工作台</a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div>
        <ul class="nav navbar-nav navbar-right">
            <li><a href="todo.html" title="事项">
                <span class="glyphicon glyphicon-bell"></span>
            </a>
            </li>
            <li><a href="#" title="邮件" onclick="goToEmail()"><span class="glyphicon glyphicon-envelope"></span></a></li>
            <li class="dropdown">
                <a href="#" title="我的" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-user"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="personalInformation.html">个人信息</a></li>
                    <li><a href="admin.html">注销</a></li>
                </ul>
            </li>
        </ul>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <div class="sidebar">
                <!--<h4>博客管理系统(四月)</h4>-->
                <!--<div class="cover">-->
                <!--<h4><img class="img-circle" src="image/icons.png"/></h4>-->
                <!--<b>Hi~ 小主</b>-->
                <!--<p>超级管理员</p>-->
                <!--</div>-->
                <ul class="sidenav animated fadeInUp">
                    <!--<li><a href="#"><span class="glyphicon glyphicon-backward" aria-hidden="true"></span></a></li>-->
                    <li class="active"><a class="withripple" href="wastesPlatform.html"><span class="glyphicon glyphicon-list" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;系统概览 </span><span class="iright pull-right">&gt;</span><span class="sr-only">(current)</span></a></li>
                    <li><a class="withripple" href="businessModel.html"><span class="glyphicon glyphicon-user" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;商务管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="compatibilityPlan.html"><span class="glyphicon glyphicon-list" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;配伍计划 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="receiveManagement.html"><span class="glyphicon glyphicon-log-in" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;接收管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="storageManagement.html"><span class="glyphicon glyphicon-save" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;贮存管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="preprocessingManagement.html"><span class="glyphicon glyphicon-sort-by-attributes-alt" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;预备管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="dispositionManagement.html"><span class="glyphicon glyphicon-retweet" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;处置管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="secondaryManagement.html"><span class="glyphicon glyphicon-tags" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;次生管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="procurementManagement.html"><span class="glyphicon glyphicon-indent-right" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;采购管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="reportManagement.html"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;报表管理 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="basicData.html"><span class="glyphicon glyphicon-signal" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;基础数据 </span><span class="iright pull-right">&gt;</span></a></li>
                    <li><a class="withripple" href="infrastructure.html"><span class="glyphicon glyphicon-cog" aria-hidden="true"></span><span class="sidespan">&nbsp;&nbsp;系统设置 </span><span class="iright pull-right">&gt;</span></a></li>
                </ul>
            </div>
        </div>

        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <div>
                <ol class="breadcrumb">

                </ol>
            </div>
            <h1 class="page-header">工作台</h1>
            <div class="row">
                <!--百度地图容器-->
                <div id="panorama" style="width: 100%;height: 100%"></div>
                <div style="width:70%;height:750px;border:#ccc solid 1px;margin-right: 20px;" id="dituContent" class="col-md-8"></div>
                <div style="width:25%;height:350px;border:#ccc solid 1px;margin-bottom: 20px;" class="col-md-4" >
                    <div id="calendar">
                        <h4>2013年10月</h4>
                        <a href="##" class="a1">上月</a>
                        <a href="##" class="a2">下月</a>
                        <ul class="week">
                            <li>日</li>
                            <li>一</li>
                            <li>二</li>
                            <li>三</li>
                            <li>四</li>
                            <li>五</li>
                            <li>六</li>
                        </ul>
                        <ul class="dateList"></ul>
                    </div>
                </div>
                <div id="dataList" style="width:25%;height:380px;border:#ccc solid 1px;margin-top: 370px;margin-left: 71.2%; overflow:auto; ">
                    <div id="cloneContent">
                        <p style="font-size: 15px;">
                            <a href="#">
                                <span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                                <span name="client"> client_data</span>
                            </a>
                        </p><br>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="embed" class="row"></div>
    <div class="modal fade" id="importExcelModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4>全景信息</h4>
                </div>
                <div class="modal-body">
                    <!--<div id="panorama" style="width: 100%;height: 100%"></div>-->
                </div>
                <div class="modal-footer"></div>
            </div>
        </div>
    </div>
    <!--详细模态框-->
    <div class="modal fade bs-example-modal-lg" id="stockInfoForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document" id="print1">
            <div class="modal-content" >
                <h4 class="sub-header text-center">库存信息</h4>
                <div style="margin: 5%;">
                    <div class="modal-body">
                        <div class="row">
                            <div class="form-horizontal col-md-4 form-inline">
                                <p class="text-left"><b>产废单位联系人&nbsp;&nbsp;</b><span id="proContactName"></span></p>
                            </div>
                            <div class="form-horizontal col-md-4">
                                <p class="text-left"><b>产废公司&nbsp;&nbsp;</b><span id="proWasteCompany"></span></p>
                            </div>
                            <div class="form-horizontal col-md-4">
                                <p class="text-left"><b>产废单位联系电话&nbsp;&nbsp;</b><span id="proTelephone"></span></p>
                            </div>
                        </div>
                        <h4><b>库存具体明细 </b></h4>
                        <form id="model-appoint4" method="post">
                            <table class="table table-bordered text-nowrap">
                                <thead>
                                <tr>
                                    <th>序号</th>
                                    <th>危险废物的名称</th>
                                    <th>危废编码</th>
                                    <th>数量(公斤)</th>
                                    <th>成分</th>
                                    <th>备注</th>
                                </tr>
                                </thead>
                                <tbody id="body2">
                                <tr id="cloneTr1" class="myclass1" >
                                    <td class="text-center">1</td><!--序号-->
                                    <td class="text-center"><input type="text" class="focus" name="wastesList[0].name" style="width:100%; height:100%;"></td><!--废物名称-->
                                    <td class="text-center">
                                        <input class="focus" type="text"  name="wastesList[0].code" id="code">
                                    </td><!--危废编码-->
                                    <td class="text-center"><input type="text" class="focus" name="wastesList[0].wasteAmount" style="width:100%; height:100%;"></td><!--危废数量-->
                                    <td class="text-center"><input type="text" class="focus" name="wastesList[0].component" style="width:100%; height:100%;"></td><!--危废成分-->
                                    <td class="text-center"><input type="text" class="focus" name="wastesList[0].remarks" style="width:100%; height:100%;"></td><!--备注-->
                                </tr>
                                </tbody>
                            </table>
                        </form>
                    </div>
                    <div class="row">
                        <!--<div class="form-horizontal col-md-4">-->
                            <!--<p class="text-left"><b>运输公司&nbsp;&nbsp;</b><span id="transport"></span></p>-->
                        <!--</div>-->
                        <!--<div class="form-horizontal col-md-3">-->
                        <!--</div>-->
                        <!--<div class="form-horizontal col-md-5">-->
                            <!--<p class="text-left"><b>车牌号&nbsp;&nbsp;</b><span id="plateNumber"></span></p>-->
                        <!--</div>-->
                    <!--</div>-->
                    <!--<div class="row">-->
                        <!--<div class="form-horizontal col-md-6">-->
                            <!--&lt;!&ndash;<p class="text-left"><b>是否自运单位&nbsp;&nbsp;</b> <input type="checkbox" id="selfEmployed" disabled="disabled"></p>&ndash;&gt;-->
                        <!--</div>-->
                        <!--<div class="form-horizontal col-md-1"></div>-->
                        <!--<div class="form-horizontal col-md-5">-->
                            <!--<p class="text-left"><b>运输公司联系电话&nbsp;&nbsp;</b><span id="transportTelephone"></span></p>-->
                        <!--</div>-->
                    </div>
                    <div class="row text-center">
                        <!--<a class="btn btn-primary hidden-print" onclick="showApproval()" id="btn">审批</a>-->
                        <!--<a class="btn btn-primary hidden-print" onclick="" id="print">打印</a>-->
                        <!--<a class="btn btn-danger hidden-print" id="back" onclick="showBack()">驳回</a>-->
                        <!--<a class="btn btn-danger hidden-print" data-dismiss="modal" id="close" onclick="re1();">关闭</a>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript">
    function dis() {
        $(".asd").removeAttr("onclick");
        document.getElementById("glyphicon").style.color="#9d9d9d";
    }
    $("#glyphicon").hover(function () {
        document.getElementById("glyphicon").style.cursor="wait";
    });

    //创建和初始化地图函数：
    function initMap(obj){
        createMap(obj);//创建地图
        setMapEvent();//设置地图事件
        addMapControl();//向地图添加控件
    }


    //载入全景信息
    window.onload = function () {
        var panorama = new BMap.Panorama("panorama");
        panorama.setPosition(new BMap.Point(119.972394,31.979135));  //设置全景中心
        panorama.setPov({heading: -40, pitch: 6});                 // 设置全景上下左右边距

        // update by whx：设置动态菜单
        loadNavigationList();
        // update 2018年12月5日 by ljc ： 增加客户显示
        loadClientData();
        // update by whx when 2019.4.18 根据角色判断权限是否显示预警信息
        showWarningInfoByRole();
    };
    //地图事件设置函数：
    function setMapEvent(){
        map.enableDragging();//启用地图拖拽事件，默认启用(可不写)
        map.enableScrollWheelZoom();//启用地图滚轮放大缩小
        map.enableDoubleClickZoom();//启用鼠标双击放大，默认启用(可不写)
        map.enableKeyboard();//启用键盘上下左右键移动地图
    }

    //地图控件添加函数：
    function addMapControl(){
        //向地图中添加缩放控件
        var ctrl_nav = new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:BMAP_NAVIGATION_CONTROL_LARGE});
        map.addControl(ctrl_nav);
        //向地图中添加缩略图控件
        var ctrl_ove = new BMap.OverviewMapControl({anchor:BMAP_ANCHOR_BOTTOM_RIGHT,isOpen:1,type:BMAP_NAVIGATION_CONTROL_LARGE});
        map.addControl(ctrl_ove);
        //向地图中添加比例尺控件
        var ctrl_sca = new BMap.ScaleControl({anchor:BMAP_ANCHOR_BOTTOM_LEFT,type:BMAP_NAVIGATION_CONTROL_LARGE});
        map.addControl(ctrl_sca);
        //向地图中添加地图类型
        map.addControl(new BMap.MapTypeControl({anchor:BMAP_ANCHOR_TOP_RIGHT,type:BMAP_NAVIGATION_CONTROL_LARGE}));
        //设置城市信息
        map.setCurrentCity("无锡市");
    }


    // initMap();//创建和初始化地图
    $(function() {

        //必要的数据
        //今天的年 月 日 ；本月的总天数；本月第一天是周几？？？
        var iNow=0;

        function run(n) {

            var oDate = new Date(); //定义时间
            oDate.setMonth(oDate.getMonth()+n);//设置月份
            var year = oDate.getFullYear(); //年
            var month = oDate.getMonth(); //月
            var today = oDate.getDate(); //日

            //计算本月有多少天
            var allDay = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month];

            //判断闰年
            if(month == 1) {
                if(year % 4 == 0 && year % 100 != 0 || year % 400 == 0) {
                    allDay = 29;
                }
            }
            //判断本月第一天是星期几
            oDate.setDate(1); //时间调整到本月第一天
            var week = oDate.getDay(); //读取本月第一天是星期几

            //console.log(week);
            $(".dateList").empty();//每次清空
            //插入空白

            for(var i = 0; i < week; i++) {
                $(".dateList").append("<li></li>");
            }

            for(var i = 1; i <= allDay; i++) {
            //日期插入到dateList
                $(".dateList").append("<li>" + i + "</li>")
            }
            //标记颜色=====================
            $(".dateList li").each(function(i, elm){
                //console.log(index,elm);
                var val = $(this).text();
                //console.log(val);
                if (n==0) {
                    if(val<today){
                        $(this).addClass('ccc')
                    }else if(val==today){
                        $(this).addClass('red')
                    }else if(i%7==0  ||  i%7==6   ){
                        $(this).addClass('sun')
                    }
                }else if(n<0){
                    $(this).addClass('ccc')
                }else if(i%7==0  ||  i%7==6   ){
                    $(this).addClass('sun')
                }
            });

            //定义标题日期
            $("#calendar h4").text(year + "年" + (month + 1) + "月");
        };
        run(0);

        $(".a1").click(function(){
            iNow--;
            run(iNow);
        });

        $(".a2").click(function(){
            iNow++;
            run(iNow);
        })
    });
    //查看
    function viewStock() {
        //查看页面 审批隐藏 打印显示 驳回隐藏
        $('#btn').hide();//审批隐藏
        $('#print').show();//打印显示
        $('#back').hide();
        //完善隐藏
        $('#perfect').hide();
        //申报公司
        var companyName = $("#info").text();
        $.ajax({
            type: "POST",                       // 方法类型
            url: "getStockByName",                   // url
            async: false,                       // 同步：意思是当有返回值以后才会进行后面的js程序
            dataType: "json",
            data: {
                'stockName': companyName
            },
            success: function (result) {
                if (result != undefined && result.status == "success") {
                    console.log(result.stock);
                    var obj = result.stock;
                    //1赋值
                    //产废单位联系人
                    // if (obj.selfEmployed == false) {//说明不是自运单位
                        //根据运输供应商赋值
                        $.ajax({
                            type: "POST",                       // 方法类型
                            url: "getSupplierListById",                  // url
                            data: {'supplierId': obj.transport},
                            async: false,                      // 同步：意思是当有返回值以后才会进行后面的js程序
                            dataType: "json",
                            //contentType: "application/json; charset=utf-8",
                            success: function (result) {
                                if (result != undefined && result.status == "success") {
                                    //console.log(result);
                                    var obj = eval(result.supplier);
                                    console.log(obj);
                                    if (obj != null) {
                                        $('#transport').text(obj.companyName);//运输公司
                                    }
                                }
                                else {
                                    alert(result.message);
                                }
                            },
                            error: function (result) {
                                alert("服务器异常！");
                            }
                        });
                        $('#plateNumber').text(obj.plateNumber);//车牌号
                        $('#transportTelephone').text(obj.transportTelephone);//运输公司联系方式
                    // }
                    // if (obj.selfEmployed == true) {//说明不是自运单位
                        $('#transport').text("");//运输公司
                        $('#plateNumber').text("");//车牌号
                        $('#transportTelephone').text("");//运输公司联系方式
                    // }
                    //赋值产废单位联系人
                    if (obj.client != null) {
                        $('#proContactName').text(obj.client.contactName);
                    }
                    if (obj.client != null) {
                        if (obj.client.phone != '') {
                            //赋值产废单位电话
                            $('#proTelephone').text(obj.client.phone);
                        }
                        else {
                            $('#proTelephone').text(obj.client.mobile);
                        }
                    }
                    //赋值是否自运单位
                    // $('#selfEmployed').prop('checked', obj.selfEmployed);
                    // //产废公司
                    if (obj.client != null) {
                        $('#proWasteCompany').text(obj.client.companyName);
                    }
                    if(obj.stockItemList!=null){
                        var tr = $("#cloneTr1");
                        tr.children('td').eq(6).html("");
                        tr.children('td').eq(7).html("");
                        tr.siblings().remove();
                        $.each(obj.stockItemList, function (index, item) {
                            var obj=eval(item);
                            // 克隆tr，每次遍历都可以产生新的tr
                            var clonedTr = tr.clone();
                            clonedTr.show();
                            // 循环遍历cloneTr的每一个td元素，并赋值
                            clonedTr.children("td").each(function (inner_index) {
                                //1生成领料单号
                                var obj = eval(item);
                                // 根据索引为部分td赋值
                                switch (inner_index) {
                                    // 序号
                                    case (0):
                                        $(this).html(index+1);
                                        break;
                                    // 危险废物的名称
                                    case (1):
                                        $(this).html(obj.wastesName);
                                        break;
                                    // 危废编码
                                    case (2):
                                        $(this).html(obj.wastesCode);
                                        break;
                                    // 数量(公斤)
                                    case (3):
                                        $(this).html(obj.number);
                                        break;
                                    // 成分
                                    case (4):

                                        $(this).html(obj.content);
                                        break;
                                    // 备注
                                    case (5):
                                        $(this).html(obj.remarks);
                                        break;
                                    //进料方式
                                    case (6):
                                        if(obj.handleCategoryItem!=null){
                                            $(this).html(obj.handleCategoryItem.dictionaryItemName)
                                        }
                                        break;
                                    //处置意见
                                    case (7):
                                        $(this).html(obj.disposalAdvice);
                                        break;
                                    //明细编号
                                    case (8):
                                        $(this).html(obj.id);
                                        break;
                                }
                            });
                            // 把克隆好的tr追加到原来的tr前面
                            clonedTr.removeAttr("id");
                            clonedTr.insertBefore(tr);


                        });
                        // 隐藏无数据的tr
                        tr.hide();
                        tr.removeAttr('class');
                    }
                } else {
                    alert(result.message);
                    // $("#modal3_contactName").text("");
                    $("#modal3_contractState").text("");
                    $("#modal3_contractVersion").text("");
                    $("#modal3_companyName").text("");
                    // $("#modal3_contactName").text("");
                    $("#modal3_contractId").text("");
                    $("#modal3_beginTime").text("");
                    $("#modal3_endTime").text("");
                    $("#modal3_area").text("");
                    $("#modal3_telephone").text("");
                    $("#modal3_order").text("");
                }
            },
            error: function (result) {
                console.log(result);
            }
        });
        $('#stockInfoForm').modal('show');
        localStorage.clear();
    }
    //联系人赋值
    function people() {
        $("#people").text($("#proContactName").text())
    }
    //联系电话赋值
    function telephone() {
        $("#telephone").text($("#proTelephone").text())
    }


</script>
<style>
    * {margin: 0;padding: 0}
    #calendar {width: 253px;margin: 100px auto;overflow: hidden;padding: 20px;position: relative;margin-top: 25px;}
    #calendar h4 {text-align: center;margin-bottom: 10px}
    #calendar .a1 {position: absolute;top: 20px;left: 20px;}
    #calendar .a2 {position: absolute;top: 20px;right: 20px;}
    #calendar .week {height: 30px;line-height: 20px;border-bottom: 1px solid #000;margin-bottom: 10px}
    #calendar .week li {float: left;width: 30px;height: 30px;text-align: center;list-style: none;}
    #calendar .dateList {overflow: hidden;clear: both}
    #calendar .dateList li {float: left;width: 30px;height: 30px;text-align: center;line-height: 30px;list-style: none;}
    #calendar .dateList .ccc {color: #ccc;}
    #calendar .dateList .red {background: #F90;color: #fff;}
    #calendar .dateList .sun {color: #f00;}
</style>
</html>